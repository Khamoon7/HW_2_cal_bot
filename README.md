# Health Tracker Telegram Bot (еда • вода • тренировки)

Телеграм-бот-трекер, который помогает:
- логировать **еду** (ккал) и **воду**,
- фиксировать **тренировки** (ккал “out” + доп. вода),
- смотреть **прогресс** за день,
- строить **графики** (за сегодня / 7 дней),
- получать **рекомендации** (вода/калории/активность + идея, что поесть).

Бот работает на **aiogram** и хранит данные в БД через **SQLAlchemy (async)**. Точка входа — `main.py`.

---

## Что умеет бот

### Основные сценарии
- **Профиль**: пол, вес, рост, возраст, активность (мин/день), город, цель (похудение/поддержание/набор), опционально — ручная цель по калориям.
- **Вода**: быстрые кнопки +100/200/300/500 мл и ручной ввод. 
- **Еда**:
  - поиск продуктов во внешних источниках,
  - выбор из top-5,
  - если не нашли — ручной ввод ккал/100г и сохранение “в свою базу” (в следующий раз будет находиться автоматически).
- **Тренировка**: тип → минуты → интенсивность; считает ккал и добавляет “calories_out”, плюс добавляет воду после тренировки. 
- **Прогресс**: сводка за сегодня (вода и калории). Сейчас в коде прогресс также подтягивает температуру (если задан OpenWeather API key). 
- **Графики**: “за сегодня” и “за 7 дней”, отправляются картинкой. 
- **Рекомендации**: вода (осталось/ок), калории (осталось/перебор), активность (тренил/не тренил), + рандом-идея еды.

### Кнопки меню
- Для нового пользователя: **Создать профиль**, **Помощь**.   
- Для пользователя с профилем: **Профиль / Прогресс / Вода / Еда / Тренировка / Графики / Рекомендации / Помощь**. 

---

## Команды
- `/start` — приветствие и стартовое меню
- `/help` — краткая справка
- `/set_profile` — заполнить/обновить профиль
- `/log_water` — добавить воду
- `/log_food` — добавить еду
- `/log_workout` — добавить тренировку
- `/check_progress` — прогресс за сегодня
- `/plot` — графики 
- `/recommend` — рекомендации на сегодня

---

## Внешние API и интеграции

### 1) Telegram Bot API
Нужен токен бота (через BotFather).

### 2) CalorieNinjas (опционально, но желательно)
Используется для поиска еды и калорийности. Если ключа нет — просто не ищем там.

**Как получить доступ**
1. Зарегистрироваться на CalorieNinjas.
2. Создать API key в кабинете.
3. Положить ключ в переменную окружения (см. ниже).

### 3) OpenFoodFacts (без ключа)
Используется как дополнительный источник данных по еде.

### 4) OpenWeather (опционально)
Используется для получения текущей температуры по городу (может влиять на цель по воде). 

**Как получить доступ**
1. Зарегистрироваться в OpenWeather.
2. Создать API key.
3. Указать ключ в переменной окружения.

### 5) Перевод RU → EN (опционально)
Если включено, бот может перевести русский запрос для более точного поиска в англоязычных источниках. 

---

## Настройка проекта

### Переменные окружения (пример)
Создай `.env` (или прокинь переменные в окружение деплоя):

- `BOT_TOKEN` — токен Telegram-бота
- `DB_PATH` — путь к базе (например: `sqlite+aiosqlite:///./bot.db` или аналогичный DSN)
- `LOG_LEVEL` — например `INFO`
- `CALORIENINJAS_API_KEY` — ключ CalorieNinjas (опционально)
- `OPENWEATHER_API_KEY` — ключ OpenWeather (опционально)
- `TRANSLATE_ENABLED` — `true/false` (опционально)

> В коде токены читаются из `settings` (см. импорт `from bot.config import settings`).   
> Убедись, что у тебя есть модуль `bot/config.py` (или аналог) который поднимает эти переменные.


### Запуск локально
1) Установи зависимости  
```bash
pip install -r requirements.txt
```
2) Заполни `.env` / переменные окружения  
3) Запусти:
```bash
python bot/main.py
